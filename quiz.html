<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Take Quiz - QuizMe</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Increase the size of radio buttons */
        input[type="radio"] {
            width: 20px;
            height: 20px;
            margin-right: 10px;
        }

        /* Increase the size of the label text */
        label {
            font-size: 18px;
        }
    </style>
</head>

<body style="font-family: Arial, sans-serif; background-color: #f9f9f9; color: #333;">

    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
        <a class="navbar-brand" href="#">QuizMe</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active">
                    <a class="nav-link" href="index.html">Home <span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="about.html">About</a>
                </li>

            </ul>
        </div>
    </nav>
    
    <div class="container mt-5">
        <h1 class="text-center" style="color: #4CAF50;">Take Quiz</h1>

        <!-- Timer Section -->
        <div class="text-center">
            <p><strong>Time Remaining:</strong> <span id="timer" style="font-size: 20px;">30</span> seconds</p>
        </div>

        <!-- Quiz Progress Section -->
        <div class="text-center">
            <p><strong>Question <span id="currentQuestionNumber">1</span> of <span id="totalQuestions">10</span></strong></p>
        </div>

        <div id="quiz-container" class="mt-4">
            <!-- Questions will be dynamically loaded here -->
        </div>
        <div class="text-center mt-4">
            <button id="submitQuiz" class="btn btn-primary">Next Question</button>
        </div>
    </div>

    <!-- Bootstrap & jQuery JavaScript -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <!-- JavaScript to handle API and Quiz -->
    <script>
        let quizData = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let timerInterval;
        const totalTime = 30; // Total time per question in seconds
        const quizName = "Science Quiz"; // You can dynamically set this value based on quiz type

        // Function to retrieve the category parameter from the URL
        function getCategoryFromUrl() {
            const params = new URLSearchParams(window.location.search);
            return params.get('category');
        }

        // Fetch the MCQs from the API using the selected category
        async function fetchQuestions() {
            const category = getCategoryFromUrl(); // Get category from the URL
            const response = await fetch(`https://opentdb.com/api.php?amount=10&category=${category}&difficulty=medium&type=multiple`);
            const data = await response.json();
            quizData = data.results;

            // Update total questions info
            document.getElementById('totalQuestions').textContent = quizData.length;

            displayQuestion();
            startTimer();
        }

        // Display the current question
        function displayQuestion() {
            const quizContainer = document.getElementById('quiz-container');
            quizContainer.innerHTML = ''; // Clear the previous question
            const currentQuestion = quizData[currentQuestionIndex];

            let answers = [...currentQuestion.incorrect_answers, currentQuestion.correct_answer];
            answers = shuffleArray(answers); // Shuffle answers

            // Question HTML
            const questionHTML = `
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">${currentQuestion.question}</h5>
                        <form id="quizForm">
                            ${answers.map(answer => `
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="answer" value="${answer}">
                                    <label class="form-check-label">${answer}</label>
                                </div>
                            `).join('')}
                        </form>
                    </div>
                </div>
            `;

            quizContainer.innerHTML = questionHTML;

            // Update question number
            document.getElementById('currentQuestionNumber').textContent = currentQuestionIndex + 1;
        }

        // Start the timer
        function startTimer() {
            let timeLeft = totalTime;
            document.getElementById('timer').textContent = timeLeft;

            // Clear the previous timer if any
            clearInterval(timerInterval);

            // Timer logic
            timerInterval = setInterval(() => {
                timeLeft--;
                document.getElementById('timer').textContent = timeLeft;

                // If time runs out
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    handleNextQuestion();
                }
            }, 1000);
        }

        // Handle moving to the next question or ending the quiz
        function handleNextQuestion() {
            const selectedAnswer = document.querySelector('input[name="answer"]:checked');
            if (selectedAnswer) {
                if (selectedAnswer.value === quizData[currentQuestionIndex].correct_answer) {
                    score++;
                }
            }

            currentQuestionIndex++;
            if (currentQuestionIndex < quizData.length) {
                displayQuestion(); // Display next question
                startTimer(); // Restart the timer
            } else {
                // Store the quiz progress when the quiz is completed
                storeQuizProgress(quizName, score, quizData.length);

                // Go to result page if quiz is done
                window.location.href = `result.html?score=${score}&total=${quizData.length}`;
            }
        }

        // Function to handle quiz submission (when user clicks Next Question)
        document.getElementById('submitQuiz').addEventListener('click', function () {
            handleNextQuestion();
        });

        // Shuffle the answers array to randomize options
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Fetch and display the first question when the page loads
        fetchQuestions();

        // Function to store quiz progress in localStorage
        function storeQuizProgress(quizName, score, totalQuestions) {
            let quizHistory = JSON.parse(localStorage.getItem('quizHistory')) || [];
            
            // Add the new quiz result
            quizHistory.push({
                quizName: quizName,
                score: score,
                totalQuestions: totalQuestions
            });
            
            // Store it back in localStorage
            localStorage.setItem('quizHistory', JSON.stringify(quizHistory));
        }
    </script>
</body>

</html>
